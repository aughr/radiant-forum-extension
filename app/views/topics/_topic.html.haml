- post = topic.posts.first

%div{:id => topic.dom_id} 
  .speaker
    - gravatar = gravatar_for(post.reader, {:size => 40, :default => "/images/furniture/no_gravatar.png"}, {:alt => post.reader.name, :class => 'gravatar offset', :width => '40', :height => '40'})
    = link_to gravatar, forum_topic_url(topic.forum, topic)

  .post_wrapper
    .post_header
      %h2
        = link_to topic.name, forum_topic_url(topic.forum, topic)
        
      %p.context
        = render :partial => "topics/context", :locals => {:topic => topic}
        = render :partial => 'posts/edit_links', :locals => {:post => post}

    .post_body
      = truncate_and_textilize(post.body, 100)

      - if Radiant::Config['forum.allow_attachments?'] && post.attachments.any?
        .post_attachments
          %h4 
            = t('attached') + ':'
          - post.attachments.images.each do |att|
            = link_to image_tag(att.thumbnail), att.file.url, :class => :thumbnail
          - if post.attachments.non_images.any?
            %ul.attachments
              - post.attachments.non_images.each do |att|
                %li
                  = link_to att.filename, att.file.url, :class => "attachment #{att.extension}"

    - if topic.has_replies?
      .post_replies
        %p.voices
          = render :partial => 'topics/voices', :locals => {:topic => topic}
        %p.replies
          = render :partial => 'topics/replies', :locals => {:topic => topic}
